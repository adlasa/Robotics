package org.usfirst.frc.team1458.robot;

import edu.wpi.first.wpilibj.DigitalInput;
import edu.wpi.first.wpilibj.Encoder;
import edu.wpi.first.wpilibj.Talon;
import edu.wpi.first.wpilibj.smartdashboard.SmartDashboard;

public class Elevator {

	// Elevator.Level.ONE.TOTE.CARRY
	// LIP=lip of tote
	// CARRY= carry level
	// PLACE = placing level
	Levels.MainLevel mainLevel = Levels.MainLevel.ONE;
	Levels.CarryObject carryObject = Levels.CarryObject.TOTE;
	Levels.LevelMode levelMode = Levels.LevelMode.FLOOR;
	Levels.LevelMod levelMod = Levels.LevelMod.LOAD;

	// Infrared elevatorBottom = new Infrared(0, 1);
	// Infrared elevatorTop = new Infrared(1, 1);
	private final double ACCEPTABLEERROR = 1.0;
	private boolean atHeight = false;

	Encoder elevatorEncoder = new Encoder(6, 7);

	DigitalInput topLimit = new DigitalInput(8);
	DigitalInput bottomLimit = new DigitalInput(9);

	double elevatorHeight;
	double desiredElevatorHeight;

	boolean isManual = true;
	boolean canMoveUp = true;
	boolean canMoveDown = true;

	Levels levelHandler = new Levels();

	public double motorMovement;

	public enum ElevatorMode {

		INTAKE(Levels.LevelMod.LOAD), OUTTAKE(Levels.LevelMod.UNLOAD), CARRY(Levels.LevelMod.LOAD);

		private Levels.LevelMod levelMod;

		private ElevatorMode(Levels.LevelMod levelMod) {
			this.levelMod = levelMod;
		}

		public Levels.LevelMod getLevelMod() {
			return this.levelMod;
		}
	}
	
	public boolean getAtHeight() {
		return atHeight;
	}

	public double getElevatorHeight() {
		return elevatorHeight;
	}

	public void setMainLevel(Levels.MainLevel mainLevel) {
		this.mainLevel = mainLevel;
		update();
	}

	public void setLevelMode(Levels.LevelMode levelMode) {
		this.levelMode = levelMode;
		update();
	}

	public void setCarryObject(Levels.CarryObject carryObject) {
		this.carryObject = carryObject;
		update();
	}

	public void setLevelMod(Levels.LevelMod levelMod) {
		this.levelMod = levelMod;
		update();
	}

	public Levels.LevelMode getLevelMode() {
		return levelMode;
	}

	public void update() {
		if (topLimit.get()) {
			canMoveUp = false;
		} else {
			canMoveUp = true;
		}
		if (bottomLimit.get()) {
			elevatorEncoder.reset();
			canMoveDown = false;
		} else {
			canMoveDown = true;
		}
		desiredElevatorHeight = levelHandler.getHeight(mainLevel, levelMode, carryObject, levelMod);
		SmartDashboard.putNumber("desiredElevatorHeight", desiredElevatorHeight);
		seeHeight();
		goTowardsDesired();

	}

	public void goTowardsDesired() {
		if (!isManual) {
			// code
			motorMovement = 0.1 * (desiredElevatorHeight - elevatorHeight);// 0.1
																			// is
																			// coeffecient
			if (!canMoveUp&&motorMovement>0) {
				

			}
			if (!canMoveDown) {

			}
		} else {
			// do nothing
		}

	}

	public void stop() {
		motorMovement = 0;
	}

	public void manualUp() {
		update();
		if (canMoveUp && isManual) {
			motorMovement = 1;
		}

	}

	public void manualDown() {
		update();
		if (canMoveDown && isManual) {
			motorMovement = -1;
		}

	}

	public void manualAmount(double power) {
		update();
		if (canMoveUp && canMoveDown && isManual) {
			motorMovement = power;
		}
	}

	public void setManual(boolean manual) {
		this.isManual = manual;
	}

	public boolean getManual() {
		return isManual;
	}

	public void seeHeight() {
		// returns height in inches
		elevatorHeight = /*
						 * 7.3125 + disabled b/c measuring from bottom of
						 * elevator
						 */(0.01121383 * elevatorEncoder.get());
		// 0.01126126
		// 0.01125687
		// 0.01112335

	}
}